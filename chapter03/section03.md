# 3.3 k近邻法的实现

k近邻法最简单的实现为线性扫描（linear scan），但该方法的效率较低。为了提高效率，可以使用kd树加速查找最近邻点。

#### 3.3.1 构造kd树

kd树是一种对 $$k$$ 维空间中的实例点进行储存以便对其进行快速检索的树形数据结构。kd树是二叉树，表示对 $$k$$ 维空间的一个划分（partition）。

**算法3-2（构造平衡kd树）**

输入： $$k$$ 维空间数据集 $$T = \{x_1, x_2, \dots, x_n\}$$ ，其中 $$x_i = (x^1, x^2, \dots, x^k)^T$$ 。

输出：kd树。

1. 选择 $$x^l$$ 为坐标轴，以 $$T$$ 中所有实例的 $$x^l$$ 坐标的中位数切分点，将 $$x^l$$ 值小于中位数的实例分到左子树，大于的分到右子树
2. 重复步骤\(1\)，令 $$l = j \mod k + 1$$ 其中 $$j$$ 为当前树的深度
3. 直至子区域没有实例存在为止

#### 3.3.2 搜索kd树

**算法3-3（用kd树的最近邻搜索）**

输入：已构造好的kd树；目标点 $$x$$ 。

输出： $$x$$ 的最近邻。

1. 从根节点出发，一直向下访问，如果 $$x$$ 当前维坐标小于切分点坐标，则往左子树移动，否则向右子树移动；直到叶子结点为止
2. 以当前叶子结点为最近邻点
3. 递归向上移动，并执行：
   1. 如果该结点保存的实例点比当前最近邻点距离 $$x$$ 更近，则以当前结点保存的实例点作为最近邻点；
   2. 检查当前结点的另一个子树是否存在更近的实例点，即子树的区域是否与以 $$x$$ 为圆心，当前最近距离为半径的圆相交；
   3. 如果相交，移动到另一个子结点，接着递归低进行最邻近搜索；
4. 当回退到根结点时，搜索结束

